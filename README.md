# GAS Tinkoff Trades
![GAS Tinkoff Trades main image](https://github.com/ErhoSen/gas-tinkoff-trades/raw/master/images/main-image.jpg "GAS Tinkoff Trades main image")

–î–∞–Ω–Ω—ã–π [Google Apps Script](https://developers.google.com/apps-script) –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Å–¥–µ–ª–æ–∫ –∏–∑ –¢–∏–Ω—å–∫–æ—Ñ—Ñ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –ø—Ä—è–º–æ –≤ Google —Ç–∞–±–ª–∏—Ü—ã, –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. 

–Ø —Å–¥–µ–ª–∞–ª —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä—É—á–Ω–æ–≥–æ –≤–±–∏–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç–∏–Ω—å–∫–æ—Ñ—Ñ, –∏ –Ω–∞–¥–µ—é—Å—å –æ–Ω –æ–∫–∞–∂–µ—Ç—Å—è –ø–æ–ª–µ–∑–µ–Ω –∫–æ–º—É-–Ω–∏–±—É–¥—å –µ—â—ë :)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

* –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç Google Spreadsheets http://drive.google.com
* –í –º–µ–Ω—é "Tools" –≤—ã–±—Ä–∞—Ç—å "Script Editor"
* –î–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—É –∏–º—è, –Ω–∞–ø—Ä–∏–º–µ—Ä `TinkoffTrades`
* –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ [Code.gs](https://raw.githubusercontent.com/ErhoSen/gas-tinkoff-trades/master/Code.gs) –∏ –∑–∞–º–µ–Ω–∏—Ç—å –∏–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–∫—Ä–∏–ø—Ç–∞.
* –ü–æ–ª—É—á–∏—Ç—å [OpenApi-—Ç–æ–∫–µ–Ω —Ç–∏–Ω—å–∫–æ—Ñ—Ñ](https://tinkoffcreditsystems.github.io/invest-openapi/auth/)
* –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ `OPENAPI_TOKEN` –≤ —Ä–∞–∑–¥–µ–ª–µ `Project properties -> Script properties` —Ä–∞–≤–Ω—ã–º —Ç–æ–∫–µ–Ω—É, –ø–æ–ª—É—á–µ–Ω–Ω–æ–º—É –≤—ã—à–µ.
* –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–ø—Ç üíæ
* –í –¥–æ–∫—É–º–µ–Ω—Ç–µ Google Spreadsheets –≤—ã–±—Ä–∞—Ç—å –ª—é–±—É—é –Ω–µ–Ω—É–∂–Ω—É—é —è—á–µ–π–∫—É –∏ –ø—Ä–∏—Å–≤–æ–∏—Ç—å –µ–π –∏–º—è `UPDATE_DATE` —Å –ø–æ–º–æ—â—å—é –º–µ–Ω—é `Data`->`Named ranges`->`Add named range`. –í —ç—Ç—É —è—á–µ–π–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–µ –º–µ–Ω—é TI->–û–±–Ω–æ–≤–∏—Ç—å –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞. –î–∞–Ω–Ω–∞—è —è—á–µ–π–∫–∞ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `dummy` –ª—é–±–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è [–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª](https://stackoverflow.com/a/27656313). –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `TI_GetLastPrice("GAZP",UPDATE_DATE)` (–ª–∏–±–æ `TI_GetLastPriceByFigi("BBG004730RP0",UPDATE_DATE)` –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –∞–∫—Ü–∏–∏ "–ì–∞–∑–ø—Ä–æ–º" –ø–æ –∫–æ–º–∞–Ω–¥–µ –º–µ–Ω—é TI->–û–±–Ω–æ–≤–∏—Ç—å.

–ù–∞ —ç—Ç–æ–º –≤—Å—ë. –¢–µ–ø–µ—Ä—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —ç—Ç–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º –Ω–∞ –≤—Å–µ—Ö –ª–∏—Å—Ç–∞—Ö –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏:
* API v2: `TI_GetAccounts()`, `TI_GetAccountID()`, `TI_GetInstrumentsID()`, `TI_GetLastPriceByFigi()`, `TI_GetLastPrice()`, `TI_GetPortfolio()`, `TI_GetOperations()` –∏ `TI_GetBidAskSpread()`
* API v1: `getPriceByTicker()`, `getTrades()`, `getPortfolio()`, `getMaxBidByTicker()`, `getMinAskByTicker()` –∏ `getBidAskSpread()`

## –§—É–Ω–∫—Ü–∏–∏ API v2

* `=TI_GetLastPriceByFigi(FIGI, UPDATE_DATE)` - —Ç—Ä–µ–±—É–µ—Ç –Ω–∞ –≤—Ö–æ–¥ FIGI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª—É—á–µ–Ω —á–µ—Ä–µ–∑ `=VLOOKUP()` –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –ø–æ –≤—Å–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º, –ø–æ–ª—É—á–µ–Ω–Ω–æ–π –≤—ã–∑–æ–≤–æ–º `=TI_GetInstrumentsID()`) –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä —Å –∏–º–µ–Ω–µ–º —è—á–µ–π–∫–∏ `UPDATE_DATE`, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—Å—è —á–µ—Ä–µ–∑ –º–µ–Ω—é TI->–û–±–Ω–æ–≤–∏—Ç—å).

* `=TI_GetInstrumentsID()` - –≤—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –≤—Å–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º, –≤–∫–ª—é—á–∞—è –∏—Ö —Ç–∏–∫–µ—Ä, FIGI, –∫–ª–∞—Å—Å, –±–∏—Ä–∂—É, –≤–∞–ª—é—Ç—É –∏ ISIN.

* `=TI_GetOperations(accountId, from, to)` - –≤—ã–≤–æ–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –Ω–æ–º–µ—Ä—É —Å—á–µ—Ç–∞ (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `TI_GetAccounts()`) –∏, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –≤—Ä–µ–º–µ–Ω–∏. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `from` –∏ `to` —è–≤–ª—è—é—Ç—Å—è —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ —è—á–µ–π–∫–∏ —Å —Ç–∏–ø–æ–º –î–∞—Ç–∞.

* `=TI_GetPortfolio(accountId)` - –≤—ã–≤–æ–¥–∏—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –Ω–æ–º–µ—Ä—É —Å—á–µ—Ç–∞ (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `TI_GetAccounts()`.

## –§—É–Ω–∫—Ü–∏–∏ API v1 (–ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ 2023 –≥–æ–¥—É)

* `=getPriceByTicker(ticker, UPDATE_DATE)` - —Ç—Ä–µ–±—É–µ—Ç –Ω–∞ –≤—Ö–æ–¥ [—Ç–∏–∫–µ—Ä](https://ru.wikipedia.org/wiki/%D0%A2%D0%B8%D0%BA%D0%B5%D1%80), –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä —Å –∏–º–µ–Ω–µ–º —è—á–µ–π–∫–∏ `UPDATE_DATE`, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—Å—è —á–µ—Ä–µ–∑ –º–µ–Ω—é TI->–û–±–Ω–æ–≤–∏—Ç—å).

* `=getTrades(ticker, from, to)` - —Ç—Ä–µ–±—É–µ—Ç –Ω–∞ –≤—Ö–æ–¥ [—Ç–∏–∫–µ—Ä](https://ru.wikipedia.org/wiki/%D0%A2%D0%B8%D0%BA%D0%B5%D1%80), –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –≤—Ä–µ–º–µ–Ω–∏. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `from` –∏ `to` —è–≤–ª—è—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∞–º–∏ –∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ [ISO 8601 —Ñ–æ—Ä–º–∞—Ç–µ](https://ru.wikipedia.org/wiki/ISO_8601)

* `=getPortfolio()` - –≤—ã–≤–æ–¥–∏—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –°—Ä–µ–¥–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∫—Ä–∏–ø—Ç–∞ –µ—Å—Ç—å `TRADING_START_AT` - –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è –¥–∞—Ç–∞, –Ω–∞—á–∏–Ω–∞—è —Å –∫–æ—Ç–æ—Ä–æ–π —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏–∏ `getTrades`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–æ `Apr 01, 2020 10:00:00`, –Ω–æ –¥–∞–Ω–Ω—É—é –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –º–æ–∂–Ω–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –ø–æ–º–µ–Ω—è—Ç—å –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ.

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π API v1

```
=getPriceByTicker("V", UPDATE_DATE)  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É –∞–∫—Ü–∏–∏ Visa
=getPriceByTicker("FXMM", UPDATE_DATE)  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É —Ñ–æ–Ω–¥–∞ –∫–∞–∑–Ω–∞—á–µ–π—Å–∫–∏—Ö –æ–±–ª–∏–≥–∞—Ü–∏–π –°–®–ê

=getTrades("V") 
# –í–µ—Ä–Ω—ë—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∞–∫—Ü–∏–µ–π Visa, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –Ω–∞—á–∏–Ω–∞—è —Å TRADING_START_AT –∏ –ø–æ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç.
=getTrades("V", "2020-05-01T00:00:00.000Z") 
# –í–µ—Ä–Ω—ë—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∞–∫—Ü–∏–µ–π Visa, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –Ω–∞—á–∏–Ω–∞—è —Å 1 –º–∞—è –∏ –ø–æ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Çs.
=getTrades("V", "2020-05-01T00:00:00.000Z", "2020-05-05T23:59:59.999Z") 
# –í–µ—Ä–Ω—ë—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∞–∫—Ü–∏–µ–π Visa, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –≤ –ø–µ—Ä–∏–æ–¥ —Å 1 –∏ –ø–æ 5 –º–∞—è.
```

## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π API v1

#### `=getTrades()`
![getTrades in action](https://github.com/ErhoSen/gas-tinkoff-trades/raw/master/images/get-trades-in-action.gif "getTrades in Action")

#### `=getPriceByTicker()`
![Get price by ticker in action](https://github.com/ErhoSen/gas-tinkoff-trades/raw/master/images/get-price-by-ticker.gif)
